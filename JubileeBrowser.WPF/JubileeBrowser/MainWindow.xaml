<Window x:Class="JubileeBrowser.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        xmlns:local="clr-namespace:JubileeBrowser"
        mc:Ignorable="d"
        Title="Jubilee Browser"
        Height="800" Width="1280"
        MinHeight="400" MinWidth="600"
        WindowStyle="None"
        ResizeMode="CanResize"
        AllowsTransparency="False"
        Background="#000000"
        WindowStartupLocation="Manual"
        SizeToContent="Manual"
        Loaded="Window_Loaded"
        Closing="Window_Closing"
        StateChanged="Window_StateChanged"
        LocationChanged="Window_LocationChanged"
        SizeChanged="Window_SizeChanged"
        KeyDown="Window_KeyDown"
        PreviewMouseWheel="Window_PreviewMouseWheel">

    <Window.Resources>
        <!-- Color Definitions matching Electron app -->
        <Color x:Key="BgPrimaryColor">#000000</Color>
        <Color x:Key="BgSecondaryColor">#16213e</Color>
        <Color x:Key="BgTertiaryColor">#0f3460</Color>
        <Color x:Key="AccentColor">#e94560</Color>
        <Color x:Key="JubileeAccentColor">#E6AC00</Color>
        <Color x:Key="TextPrimaryColor">#ffffff</Color>
        <Color x:Key="TextSecondaryColor">#a0a0a0</Color>
        <Color x:Key="BorderColor">#2a2a4e</Color>

        <SolidColorBrush x:Key="BgPrimaryBrush" Color="{StaticResource BgPrimaryColor}"/>
        <SolidColorBrush x:Key="BgSecondaryBrush" Color="{StaticResource BgSecondaryColor}"/>
        <SolidColorBrush x:Key="BgTertiaryBrush" Color="{StaticResource BgTertiaryColor}"/>
        <SolidColorBrush x:Key="AccentBrush" Color="{StaticResource AccentColor}"/>
        <SolidColorBrush x:Key="JubileeAccentBrush" Color="{StaticResource JubileeAccentColor}"/>
        <SolidColorBrush x:Key="TextPrimaryBrush" Color="{StaticResource TextPrimaryColor}"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="{StaticResource TextSecondaryColor}"/>
        <SolidColorBrush x:Key="BorderBrush" Color="{StaticResource BorderColor}"/>

        <!-- Bookmark Button Style (no hover effect) -->
        <Style x:Key="BookmarkButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="24"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="Transparent" Padding="2">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Button Style -->
        <Style x:Key="NavButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="4"
                                Padding="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#3a3a5e"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#4a4a6e"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Window Control Button Style -->
        <Style x:Key="WindowButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="46"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#3a3a5e"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="CloseButtonStyle" TargetType="Button" BasedOn="{StaticResource WindowButtonStyle}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#e81123"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Tab Item Style -->
        <Style x:Key="BrowserTabStyle" TargetType="ListBoxItem">
            <Setter Property="Background" Value="#252545"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="MinWidth" Value="120"/>
            <Setter Property="MaxWidth" Value="240"/>
            <Setter Property="Margin" Value="0,0,0,0"/>
            <Setter Property="VerticalAlignment" Value="Bottom"/>
            <Setter Property="Opacity" Value="0.5"/>
            <Setter Property="Panel.ZIndex" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="1"/>
                            </Grid.ColumnDefinitions>
                            <Border x:Name="border"
                                    Grid.Column="0"
                                    Background="{TemplateBinding Background}"
                                    CornerRadius="6,6,0,0"
                                    Padding="8,0">
                                <Grid Margin="0,-2,0,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="16"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="24"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid Grid.Column="0" Width="16" Height="16" VerticalAlignment="Center">
                                        <!-- Favicon from website (hidden when no favicon) -->
                                        <Image x:Name="tabFavicon"
                                               Source="{Binding Favicon}"
                                               Width="16" Height="16">
                                            <Image.Style>
                                                <Style TargetType="Image">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Favicon}" Value="{x:Null}">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Favicon}" Value="">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Image.Style>
                                        </Image>
                                        <!-- Default WWBW icon for active WWBW tabs when no favicon (black, smaller) -->
                                        <Image x:Name="tabDefaultWWBWIconActive"
                                               Source="Resources/Icons/wwbw-black.png"
                                               Width="14" Height="14"
                                               Visibility="Collapsed"/>
                                        <!-- Default WWBW icon for inactive WWBW tabs when no favicon (white) -->
                                        <Image x:Name="tabDefaultWWBWIconInactive"
                                               Source="Resources/Icons/wwbw-white.png"
                                               Width="14" Height="14"
                                               Visibility="Collapsed"/>
                                        <!-- Default WWBW icon for WWW tabs with inspire:// URLs when no favicon (white, 14px to match yellow tabs) -->
                                        <Image x:Name="tabDefaultInspireIcon"
                                               Source="Resources/Icons/wwbw-white.png"
                                               Width="14" Height="14"
                                               Visibility="Collapsed"/>
                                    </Grid>
                                    <TextBlock x:Name="titleText" Grid.Column="1"
                                              Text="{Binding Title}"
                                              VerticalAlignment="Center"
                                              Margin="8,0"
                                              TextTrimming="CharacterEllipsis"
                                              FontWeight="Normal"
                                              Foreground="{TemplateBinding Foreground}"/>
                                    <Button x:Name="closeBtn" Grid.Column="2"
                                            Style="{StaticResource NavButtonStyle}"
                                            Width="18" Height="18"
                                            Click="TabCloseButton_Click"
                                            Tag="{Binding Id}">
                                        <TextBlock x:Name="closeBtnIcon" Text="&#xE711;" FontFamily="Segoe MDL2 Assets" FontSize="9" Foreground="White"/>
                                    </Button>
                                </Grid>
                            </Border>
                            <!-- Tab Divider -->
                            <Border x:Name="divider" Grid.Column="1" Width="1"
                                    Background="#3a3a5e" VerticalAlignment="Stretch"
                                    Margin="0,6,0,6"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <!-- Active WWBW tab: Yellow background to match nav bar, black text, full opacity -->
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding Mode}" Value="JubileeBibles"/>
                                    <Condition Binding="{Binding RelativeSource={RelativeSource Self}, Path=IsSelected}" Value="True"/>
                                </MultiDataTrigger.Conditions>
                                <Setter TargetName="border" Property="Background" Value="#FFD700"/>
                                <Setter TargetName="titleText" Property="Foreground" Value="#1a1a2e"/>
                                <Setter TargetName="titleText" Property="FontWeight" Value="Bold"/>
                                <Setter TargetName="divider" Property="Visibility" Value="Collapsed"/>
                                <Setter TargetName="closeBtnIcon" Property="Foreground" Value="#1a1a2e"/>
                                <Setter Property="Opacity" Value="1.0"/>
                                <Setter Property="Panel.ZIndex" Value="10"/>
                            </MultiDataTrigger>
                            <!-- Hover on close button for active WWBW tab: Yellow X -->
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding Mode}" Value="JubileeBibles"/>
                                    <Condition Binding="{Binding RelativeSource={RelativeSource Self}, Path=IsSelected}" Value="True"/>
                                    <Condition Binding="{Binding ElementName=closeBtn, Path=IsMouseOver}" Value="True"/>
                                </MultiDataTrigger.Conditions>
                                <Setter TargetName="closeBtnIcon" Property="Foreground" Value="#FFD700"/>
                                <Setter TargetName="closeBtnIcon" Property="FontWeight" Value="Bold"/>
                            </MultiDataTrigger>
                            <!-- Active WWW tab: Blue background to match nav bar, white text, full opacity -->
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding Mode}" Value="Internet"/>
                                    <Condition Binding="{Binding RelativeSource={RelativeSource Self}, Path=IsSelected}" Value="True"/>
                                </MultiDataTrigger.Conditions>
                                <Setter TargetName="border" Property="Background" Value="#0099FF"/>
                                <Setter TargetName="titleText" Property="Foreground" Value="White"/>
                                <Setter TargetName="titleText" Property="FontWeight" Value="Bold"/>
                                <Setter TargetName="divider" Property="Visibility" Value="Collapsed"/>
                                <Setter TargetName="closeBtnIcon" Property="Foreground" Value="White"/>
                                <Setter Property="Opacity" Value="1.0"/>
                                <Setter Property="Panel.ZIndex" Value="10"/>
                            </MultiDataTrigger>
                            <!-- Inactive WWBW tabs: Gold/yellow background at 50% opacity, white text full opacity -->
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding Mode}" Value="JubileeBibles"/>
                                    <Condition Binding="{Binding RelativeSource={RelativeSource Self}, Path=IsSelected}" Value="False"/>
                                </MultiDataTrigger.Conditions>
                                <Setter TargetName="border" Property="Background" Value="#80E6AC00"/>
                                <Setter TargetName="titleText" Property="Foreground" Value="White"/>
                                <Setter TargetName="closeBtnIcon" Property="Foreground" Value="White"/>
                                <Setter TargetName="divider" Property="Background" Value="#80CC9900"/>
                                <Setter Property="Opacity" Value="1.0"/>
                            </MultiDataTrigger>
                            <!-- Inactive WWW tabs: Blue background at 50% opacity, white text full opacity -->
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding Mode}" Value="Internet"/>
                                    <Condition Binding="{Binding RelativeSource={RelativeSource Self}, Path=IsSelected}" Value="False"/>
                                </MultiDataTrigger.Conditions>
                                <Setter TargetName="border" Property="Background" Value="#800099FF"/>
                                <Setter TargetName="titleText" Property="Foreground" Value="White"/>
                                <Setter TargetName="closeBtnIcon" Property="Foreground" Value="White"/>
                                <Setter Property="Opacity" Value="1.0"/>
                            </MultiDataTrigger>
                            <!-- Mouseover effect for inactive tabs - slightly brighter background -->
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsMouseOver" Value="True"/>
                                    <Condition Property="IsSelected" Value="False"/>
                                </MultiTrigger.Conditions>
                                <Setter TargetName="border" Property="Opacity" Value="0.85"/>
                            </MultiTrigger>
                            <!-- Show black WWBW icon for ACTIVE WWBW tabs when no favicon -->
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding Mode}" Value="JubileeBibles"/>
                                    <Condition Binding="{Binding RelativeSource={RelativeSource Self}, Path=IsSelected}" Value="True"/>
                                    <Condition Binding="{Binding Favicon}" Value="{x:Null}"/>
                                </MultiDataTrigger.Conditions>
                                <Setter TargetName="tabDefaultWWBWIconActive" Property="Visibility" Value="Visible"/>
                            </MultiDataTrigger>
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding Mode}" Value="JubileeBibles"/>
                                    <Condition Binding="{Binding RelativeSource={RelativeSource Self}, Path=IsSelected}" Value="True"/>
                                    <Condition Binding="{Binding Favicon}" Value=""/>
                                </MultiDataTrigger.Conditions>
                                <Setter TargetName="tabDefaultWWBWIconActive" Property="Visibility" Value="Visible"/>
                            </MultiDataTrigger>
                            <!-- Show white WWBW icon for INACTIVE WWBW tabs when no favicon -->
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding Mode}" Value="JubileeBibles"/>
                                    <Condition Binding="{Binding RelativeSource={RelativeSource Self}, Path=IsSelected}" Value="False"/>
                                    <Condition Binding="{Binding Favicon}" Value="{x:Null}"/>
                                </MultiDataTrigger.Conditions>
                                <Setter TargetName="tabDefaultWWBWIconInactive" Property="Visibility" Value="Visible"/>
                            </MultiDataTrigger>
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding Mode}" Value="JubileeBibles"/>
                                    <Condition Binding="{Binding RelativeSource={RelativeSource Self}, Path=IsSelected}" Value="False"/>
                                    <Condition Binding="{Binding Favicon}" Value=""/>
                                </MultiDataTrigger.Conditions>
                                <Setter TargetName="tabDefaultWWBWIconInactive" Property="Visibility" Value="Visible"/>
                            </MultiDataTrigger>
                            <!-- Show white WWBW icon for WWW tabs with inspire:// URLs when no favicon (active) -->
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding Mode}" Value="Internet"/>
                                    <Condition Binding="{Binding IsInspireUrl}" Value="True"/>
                                    <Condition Binding="{Binding Favicon}" Value="{x:Null}"/>
                                </MultiDataTrigger.Conditions>
                                <Setter TargetName="tabDefaultInspireIcon" Property="Visibility" Value="Visible"/>
                            </MultiDataTrigger>
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding Mode}" Value="Internet"/>
                                    <Condition Binding="{Binding IsInspireUrl}" Value="True"/>
                                    <Condition Binding="{Binding Favicon}" Value=""/>
                                </MultiDataTrigger.Conditions>
                                <Setter TargetName="tabDefaultInspireIcon" Property="Visibility" Value="Visible"/>
                            </MultiDataTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Address Bar Style -->
        <Style x:Key="AddressBarStyle" TargetType="TextBox">
            <Setter Property="Background" Value="#252545"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8,0"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="16"
                                BorderBrush="Transparent"
                                BorderThickness="0"
                                Padding="{TemplateBinding Padding}">
                            <ScrollViewer x:Name="PART_ContentHost"
                                         VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter Property="Background" Value="#303050"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ModeToggleButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="24"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="8">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Opacity" Value="0.9"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Opacity" Value="0.8"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Mode Radio Button Style for WWW -->
        <Style x:Key="ModeRadioWWWStyle" TargetType="RadioButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="MinWidth" Value="70"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="border"
                                CornerRadius="4"
                                Background="{TemplateBinding Background}"
                                BorderThickness="0"
                                Padding="6,4">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <!-- Radio circle -->
                                <Grid Width="18" Height="18" Margin="0,0,6,0">
                                    <Ellipse x:Name="outerCircle"
                                             Width="18" Height="18"
                                             Stroke="{TemplateBinding Foreground}"
                                             StrokeThickness="2"
                                             Fill="Transparent"/>
                                    <Ellipse x:Name="innerDot"
                                             Width="10" Height="10"
                                             Fill="{TemplateBinding Foreground}"
                                             HorizontalAlignment="Center"
                                             VerticalAlignment="Center"
                                             Visibility="Collapsed"/>
                                </Grid>
                                <TextBlock x:Name="label"
                                          Text="WWW"
                                          FontSize="12"
                                          FontWeight="Bold"
                                          Foreground="{TemplateBinding Foreground}"
                                          VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="innerDot" Property="Visibility" Value="Visible"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="False">
                                <Setter TargetName="innerDot" Property="Visibility" Value="Collapsed"/>
                                <Setter TargetName="label" Property="Foreground" Value="Black"/>
                                <Setter TargetName="outerCircle" Property="Stroke" Value="Black"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Opacity" Value="0.85"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Mode Radio Button Style for WWBW -->
        <Style x:Key="ModeRadioWWBWStyle" TargetType="RadioButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="MinWidth" Value="80"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="border"
                                CornerRadius="4"
                                Background="{TemplateBinding Background}"
                                BorderThickness="0"
                                Padding="6,4">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <!-- Radio circle -->
                                <Grid Width="18" Height="18" Margin="0,0,6,0">
                                    <Ellipse x:Name="outerCircle"
                                             Width="18" Height="18"
                                             Stroke="{TemplateBinding Foreground}"
                                             StrokeThickness="2"
                                             Fill="Transparent"/>
                                    <Ellipse x:Name="innerDot"
                                             Width="10" Height="10"
                                             Fill="{TemplateBinding Foreground}"
                                             HorizontalAlignment="Center"
                                             VerticalAlignment="Center"
                                             Visibility="Collapsed"/>
                                </Grid>
                                <TextBlock x:Name="label"
                                          Text="WWBW"
                                          FontSize="12"
                                          FontWeight="Bold"
                                          Foreground="{TemplateBinding Foreground}"
                                          VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="innerDot" Property="Visibility" Value="Visible"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="False">
                                <Setter TargetName="innerDot" Property="Visibility" Value="Collapsed"/>
                                <Setter TargetName="label" Property="Foreground" Value="White"/>
                                <Setter TargetName="outerCircle" Property="Stroke" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Opacity" Value="0.85"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid Background="Black">
        <Grid.RowDefinitions>
            <!-- Title Bar with Tabs: 36px -->
            <RowDefinition x:Name="TitleBarRow" Height="36"/>
            <!-- Navigation Bar: 38px -->
            <RowDefinition x:Name="NavBarRow" Height="38"/>
            <!-- Content Area -->
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Title Bar with Tabs -->
        <Grid x:Name="TitleBar" Grid.Row="0" Background="Black" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
            <Grid.ColumnDefinitions>
                <!-- Tabs Area with New Tab Button -->
                <ColumnDefinition Width="*"/>
                <!-- Window Controls -->
                <ColumnDefinition Width="138"/>
            </Grid.ColumnDefinitions>

            <!-- Tab Strip with New Tab Button -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="8,0,0,0" VerticalAlignment="Bottom">
                <ListBox x:Name="TabStrip"
                         VerticalAlignment="Bottom"
                         Background="Transparent"
                         BorderThickness="0"
                         ItemContainerStyle="{StaticResource BrowserTabStyle}"
                         SelectionChanged="TabStrip_SelectionChanged"
                         AllowDrop="True"
                         PreviewMouseLeftButtonDown="TabStrip_PreviewMouseLeftButtonDown"
                         PreviewMouseMove="TabStrip_PreviewMouseMove"
                         Drop="TabStrip_Drop"
                         DragOver="TabStrip_DragOver"
                         ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                         ScrollViewer.VerticalScrollBarVisibility="Disabled">
                    <ListBox.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ListBox.ItemsPanel>
                </ListBox>

                <!-- New Tab Button - styled as a permanent black tab -->
                <Border x:Name="NewTabButton"
                        Background="#000000"
                        CornerRadius="6,6,0,0"
                        Height="32"
                        MinWidth="40"
                        Margin="2,0,0,0"
                        VerticalAlignment="Bottom"
                        Cursor="Hand"
                        ToolTip="New Tab (Ctrl+T)"
                        MouseLeftButtonDown="NewTabButton_Click">
                    <TextBlock Text="+"
                               FontSize="20"
                               FontWeight="Bold"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               Margin="10,0,10,15">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="White"/>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Foreground" Value="#FFD700"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </Border>
            </StackPanel>

            <!-- Window Controls -->
            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,-5,0,0">
                <Button x:Name="MinimizeButton"
                        Style="{StaticResource WindowButtonStyle}"
                        Click="MinimizeButton_Click"
                        Content="&#xE921;"/>
                <Button x:Name="MaximizeButton"
                        Style="{StaticResource WindowButtonStyle}"
                        Click="MaximizeButton_Click"
                        Content="&#xE922;"/>
                <Button x:Name="CloseButton"
                        Style="{StaticResource CloseButtonStyle}"
                        Click="CloseButton_Click"
                        Content="&#xE8BB;"/>
            </StackPanel>
        </Grid>

        <!-- Navigation Bar - spans into title bar row to eliminate line -->
        <Grid x:Name="NavigationBar" Grid.Row="1" Background="{StaticResource BgSecondaryBrush}" Margin="0,-8,0,0">
            <Grid.ColumnDefinitions>
                <!-- Navigation Buttons -->
                <ColumnDefinition Width="Auto"/>
                <!-- Address Bar -->
                <ColumnDefinition Width="*"/>
                <!-- Mode Switch Button -->
                <ColumnDefinition Width="Auto"/>
                <!-- Right Actions -->
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Navigation Buttons -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="12,0,8,0">
                <Button x:Name="BackButton"
                        Style="{StaticResource NavButtonStyle}"
                        Click="BackButton_Click"
                        IsEnabled="False"
                        ToolTip="Back (Alt+Left)">
                    <TextBlock Text="&#xE72B;" FontFamily="Segoe MDL2 Assets" FontSize="18" FontWeight="Bold"/>
                </Button>
                <Button x:Name="ForwardButton"
                        Style="{StaticResource NavButtonStyle}"
                        Click="ForwardButton_Click"
                        IsEnabled="False"
                        Margin="4,0,0,0"
                        ToolTip="Forward (Alt+Right)">
                    <TextBlock Text="&#xE72A;" FontFamily="Segoe MDL2 Assets" FontSize="18" FontWeight="Bold"/>
                </Button>
                <Button x:Name="ReloadButton"
                        Style="{StaticResource NavButtonStyle}"
                        Click="ReloadButton_Click"
                        Margin="4,0,0,0"
                        ToolTip="Reload (Ctrl+R)">
                    <TextBlock x:Name="ReloadIcon" Text="&#xE72C;" FontFamily="Segoe MDL2 Assets" FontSize="18" FontWeight="Bold"/>
                </Button>
            </StackPanel>

            <!-- Address Bar with Mode Icon inside -->
            <Grid Grid.Column="1" Margin="8,6">
                <TextBox x:Name="AddressBar"
                         Style="{StaticResource AddressBarStyle}"
                         KeyDown="AddressBar_KeyDown"
                         GotFocus="AddressBar_GotFocus"
                         Padding="18,0,32,0"/>
                <!-- Mode Icon overlay - positioned inside the textbox on the left -->
                <Grid Width="28" HorizontalAlignment="Left" Margin="4,0,0,0" IsHitTestVisible="False">
                    <!-- WWBW icon for WWBW mode -->
                    <Image x:Name="AddressBarWWBWIcon"
                           Source="Resources/Icons/wwbw.png"
                           Width="16" Height="16"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center"
                           Margin="0,2,0,0"
                           Visibility="Collapsed"/>
                    <!-- Globe icon for WWW mode (regular URLs) -->
                    <TextBlock x:Name="AddressBarGlobeIcon"
                              Text="&#xE774;"
                              FontFamily="Segoe MDL2 Assets"
                              FontSize="16"
                              Foreground="White"
                              VerticalAlignment="Center"
                              HorizontalAlignment="Center"
                              Visibility="Visible"/>
                    <!-- WWBW icon for inspire:// URLs in WWW mode (white version) -->
                    <Image x:Name="AddressBarInspireIcon"
                           Source="Resources/Icons/wwbw-white.png"
                           Width="16" Height="16"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center"
                           Margin="0,2,0,0"
                           Visibility="Collapsed"/>
                </Grid>
                <!-- Zoom Level Display - positioned inside the textbox on the right, before bookmark -->
                <Button x:Name="ZoomLevelButton"
                        HorizontalAlignment="Right"
                        Margin="0,0,26,0"
                        Padding="2,0"
                        Background="Transparent"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="ZoomLevelButton_Click"
                        ToolTip="Reset Zoom Level (Ctrl+0)"
                        Visibility="Collapsed">
                    <TextBlock x:Name="ZoomLevelText"
                              Text="100%"
                              FontSize="10"
                              Foreground="#888888"
                              VerticalAlignment="Center"/>
                </Button>
                <!-- Bookmark Star Icon - positioned inside the textbox on the right -->
                <Button x:Name="BookmarkButton"
                        Style="{StaticResource BookmarkButtonStyle}"
                        HorizontalAlignment="Right"
                        Margin="0,0,4,0"
                        Click="BookmarkButton_Click"
                        ToolTip="Add Bookmark (Ctrl+D)">
                    <TextBlock x:Name="BookmarkIcon" Text="&#xE734;" FontFamily="Segoe MDL2 Assets" FontSize="14"/>
                </Button>
            </Grid>

            <!-- Mode Switch Button (after address bar) -->
            <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="4,0">
                <!-- Globe button - shown in WWBW mode to switch to WWW -->
                <Button x:Name="AddressBarModeGlobeButton"
                        Style="{StaticResource NavButtonStyle}"
                        Width="32" Height="32"
                        Click="ModeToggle_Click"
                        MouseEnter="AddressBarModeGlobeButton_MouseEnter"
                        MouseLeave="AddressBarModeGlobeButton_MouseLeave"
                        ToolTip="Switch to WWW mode"
                        Visibility="Collapsed">
                    <TextBlock x:Name="AddressBarModeGlobeIcon" Text="&#xE774;" FontFamily="Segoe MDL2 Assets" FontSize="18" Foreground="Black"/>
                </Button>
                <!-- WWBW button - shown in WWW mode to switch to WWBW -->
                <Button x:Name="AddressBarModeBibleButton"
                        Style="{StaticResource NavButtonStyle}"
                        Width="32" Height="32"
                        Click="ModeToggle_Click"
                        MouseEnter="AddressBarModeBibleButton_MouseEnter"
                        MouseLeave="AddressBarModeBibleButton_MouseLeave"
                        ToolTip="Switch to WWBW mode"
                        Visibility="Visible">
                    <Grid>
                        <!-- White icon (default) -->
                        <Image x:Name="WWBWButtonIconWhite"
                               Source="Resources/Icons/wwbw-white.png"
                               Width="20" Height="20"
                               Visibility="Visible"/>
                        <!-- Yellow/color icon (on hover) -->
                        <Image x:Name="WWBWButtonIconColor"
                               Source="Resources/Icons/wwbw.png"
                               Width="20" Height="20"
                               Visibility="Collapsed"/>
                    </Grid>
                </Button>
            </StackPanel>

            <!-- Right Actions -->
            <StackPanel Grid.Column="3" Orientation="Horizontal" Margin="8,0">
                <!-- Mode Toggle Button - shows icon to switch to other mode -->
                <Button x:Name="ModeToggleBorder"
                        Style="{StaticResource ModeToggleButtonStyle}"
                        Background="#000000"
                        Margin="8,0"
                        Click="ModeToggle_Click"
                        ToolTip="Switch to WWW mode">
                    <!-- Globe icon for switching to WWW mode (shown in WWBW mode) -->
                    <TextBlock x:Name="ModeToggleGlobeIcon"
                               Text="&#xE774;"
                               FontFamily="Segoe MDL2 Assets"
                               FontSize="14"
                               Foreground="#C8C8C8"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Center"
                               Visibility="Collapsed"/>
                </Button>
                <!-- Profile/Avatar toggle for WWBW mode (shown in WWW mode) -->
                <Button x:Name="ModeToggleAvatarBorder"
                        Style="{StaticResource ModeToggleButtonStyle}"
                        Background="#0078D4"
                        Margin="8,0"
                        Click="ModeToggle_Click"
                        ToolTip="Switch to WWBW mode"
                        Visibility="Visible">
                    <Ellipse Width="20" Height="20" Stroke="White" StrokeThickness="1">
                        <Ellipse.Fill>
                            <ImageBrush x:Name="ModeToggleAvatarImage" ImageSource="Resources/Icons/icon.ico" Stretch="UniformToFill"/>
                        </Ellipse.Fill>
                    </Ellipse>
                </Button>
                <!-- Hidden radio buttons for state management -->
                <RadioButton x:Name="ModeRadioWWW"
                             GroupName="BrowserMode"
                             IsChecked="True"
                             Checked="ModeRadio_Changed"
                             Visibility="Collapsed"/>
                <RadioButton x:Name="ModeRadioWWBW"
                             GroupName="BrowserMode"
                             Checked="ModeRadio_Changed"
                             Visibility="Collapsed"/>

                <Button x:Name="HistoryButton"
                        Style="{StaticResource NavButtonStyle}"
                        Click="HistoryButton_Click"
                        ToolTip="History (Ctrl+H)">
                    <TextBlock Text="&#xE81C;" FontFamily="Segoe MDL2 Assets" FontSize="14"/>
                </Button>
                <Button x:Name="BookmarksButton"
                        Style="{StaticResource NavButtonStyle}"
                        Click="BookmarksButton_Click"
                        ToolTip="Bookmarks (Ctrl+Shift+B)">
                    <TextBlock Text="&#xE728;" FontFamily="Segoe MDL2 Assets" FontSize="14"/>
                </Button>
                <Button x:Name="SettingsButton"
                        Style="{StaticResource NavButtonStyle}"
                        Click="SettingsButton_Click"
                        ToolTip="Settings">
                    <TextBlock Text="&#xE712;" FontFamily="Segoe MDL2 Assets" FontSize="14"/>
                </Button>
                <Button x:Name="MenuButton"
                        Style="{StaticResource NavButtonStyle}"
                        Click="MenuButton_Click"
                        ToolTip="Menu">
                    <TextBlock Text="&#xE700;" FontFamily="Segoe MDL2 Assets" FontSize="14"/>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Main Content Area -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <!-- Side Panel (History/Bookmarks) -->
                <ColumnDefinition x:Name="SidePanelColumn" Width="0"/>
                <!-- Browser Content -->
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Side Panel -->
            <Border x:Name="SidePanel"
                    Grid.Column="0"
                    Background="{StaticResource BgSecondaryBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="0,0,1,0"
                    Visibility="Collapsed">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="40"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Side Panel Header -->
                    <Border Grid.Row="0"
                            BorderBrush="{StaticResource BorderBrush}"
                            BorderThickness="0,0,0,1">
                        <Grid>
                            <TextBlock x:Name="SidePanelTitle"
                                      Text="History"
                                      Foreground="{StaticResource TextPrimaryBrush}"
                                      FontSize="14"
                                      FontWeight="SemiBold"
                                      VerticalAlignment="Center"
                                      Margin="12,0"/>
                            <Button Style="{StaticResource NavButtonStyle}"
                                    HorizontalAlignment="Right"
                                    Margin="4"
                                    Click="CloseSidePanel_Click">
                                <TextBlock Text="&#xE8BB;" FontFamily="Segoe MDL2 Assets" FontSize="10"/>
                            </Button>
                        </Grid>
                    </Border>

                    <!-- Side Panel Content -->
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <ListBox x:Name="SidePanelList"
                                Background="Transparent"
                                BorderThickness="0"
                                Foreground="{StaticResource TextPrimaryBrush}"
                                SelectionChanged="SidePanelList_SelectionChanged"/>
                    </ScrollViewer>
                </Grid>
            </Border>

            <!-- WebView Container -->
            <Grid x:Name="WebViewContainer" Grid.Column="1" Background="{StaticResource BgPrimaryBrush}">
                <!-- Welcome Message (shown when no tabs) -->
                <StackPanel x:Name="WelcomePanel"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Visibility="Collapsed">
                    <TextBlock Text="Welcome to Jubilee Browser"
                              Foreground="{StaticResource TextPrimaryBrush}"
                              FontSize="28"
                              FontWeight="Light"
                              HorizontalAlignment="Center"/>
                    <TextBlock Text="Press Ctrl+T to open a new tab"
                              Foreground="{StaticResource TextSecondaryBrush}"
                              FontSize="14"
                              Margin="0,12,0,0"
                              HorizontalAlignment="Center"/>
                </StackPanel>

                <!-- Loading Indicator -->
                <ProgressBar x:Name="LoadingBar"
                            Height="2"
                            VerticalAlignment="Top"
                            IsIndeterminate="True"
                            Visibility="Collapsed"
                            Foreground="{StaticResource AccentBrush}"
                            Background="Transparent"
                            BorderThickness="0"/>
            </Grid>
        </Grid>

        <!-- RESIZE BORDERS - Must be LAST in Grid to be on top of WebView2 -->
        <!-- These span all rows and sit on top of everything to intercept mouse events -->

        <!-- Left Edge -->
        <Rectangle x:Name="ResizeLeft"
                   Grid.Row="2"
                   Width="3"
                   HorizontalAlignment="Left"
                   Fill="Transparent"
                   Cursor="SizeWE"
                   MouseLeftButtonDown="ResizeBorder_MouseLeftButtonDown"
                   Tag="Left"/>

        <!-- Right Edge -->
        <Rectangle x:Name="ResizeRight"
                   Grid.Row="2"
                   Width="3"
                   HorizontalAlignment="Right"
                   Fill="Transparent"
                   Cursor="SizeWE"
                   MouseLeftButtonDown="ResizeBorder_MouseLeftButtonDown"
                   Tag="Right"/>

        <!-- Bottom Edge -->
        <Rectangle x:Name="ResizeBottom"
                   Grid.Row="2"
                   Height="3"
                   VerticalAlignment="Bottom"
                   Fill="Transparent"
                   Cursor="SizeNS"
                   MouseLeftButtonDown="ResizeBorder_MouseLeftButtonDown"
                   Tag="Bottom"/>

        <!-- Bottom-Left Corner -->
        <Rectangle x:Name="ResizeBottomLeft"
                   Grid.Row="2"
                   Width="8" Height="8"
                   HorizontalAlignment="Left"
                   VerticalAlignment="Bottom"
                   Fill="Transparent"
                   Cursor="SizeNESW"
                   MouseLeftButtonDown="ResizeBorder_MouseLeftButtonDown"
                   Tag="BottomLeft"/>

        <!-- Bottom-Right Corner -->
        <Rectangle x:Name="ResizeBottomRight"
                   Grid.Row="2"
                   Width="8" Height="8"
                   HorizontalAlignment="Right"
                   VerticalAlignment="Bottom"
                   Fill="Transparent"
                   Cursor="SizeNWSE"
                   MouseLeftButtonDown="ResizeBorder_MouseLeftButtonDown"
                   Tag="BottomRight"/>

        <!-- Context Menu for Tabs -->
        <Grid.ContextMenu>
            <ContextMenu x:Name="TabContextMenu" Background="#2a2a4e" Foreground="White">
                <MenuItem Header="New Tab" Click="NewTab_Click" InputGestureText="Ctrl+T"/>
                <MenuItem Header="Duplicate Tab" Click="DuplicateTab_Click"/>
                <Separator/>
                <MenuItem Header="Pin Tab" Click="PinTab_Click"/>
                <MenuItem Header="Mute Tab" Click="MuteTab_Click"/>
                <Separator/>
                <MenuItem Header="Close Tab" Click="CloseCurrentTab_Click" InputGestureText="Ctrl+W"/>
                <MenuItem Header="Close Other Tabs" Click="CloseOtherTabs_Click"/>
                <MenuItem Header="Close Tabs to the Right" Click="CloseTabsToRight_Click"/>
                <Separator/>
                <MenuItem Header="Reopen Closed Tab" Click="ReopenClosedTab_Click" InputGestureText="Ctrl+Shift+T"/>
            </ContextMenu>
        </Grid.ContextMenu>
    </Grid>
</Window>
